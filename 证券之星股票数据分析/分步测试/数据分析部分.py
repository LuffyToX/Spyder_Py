# -*- coding:utf-8 -*-
import os
import matplotlib.pyplot as plt
import re
from multiprocessing import Process
import time

class Data_analysis:
    """ 可视化的数据分析 """

    def __init__(self, data):
        self.data = data


    def pre_precess(self, num):
        """ 预处理 """

        """ 以股价进行排序 """

        ''' 将列表变为每个子列表有13个数据的嵌套列表(因为股票信息有13列数据) '''
        n = 13
        lst = [self.data[i:i + n] for i in range(0, len(self.data), n)]
        # print(data, '\n', len(data), sep='')

        ''' 列表去重 '''
        data = []
        for i in lst:
            if not i in data:
                data.append(i)

        ''' 冒泡法排序(由小到大) '''
        pat = re.compile(r"\d+\.?\d*") # 用于提取数字
        length = len(data)
        # 一共进行(length-1)轮排序
        for i in range(0, length - 1):
            for j in range(0, length - 1 - i):
                if float(re.findall(pat, data[j][num])[0]) > float(re.findall(pat, data[j+1][num])[0]):  # 注意元素是字符串
                    data[j], data[j + 1] = data[j + 1], data[j]
        #for value in data:
        #    print(value[num])

        return data


    def price(self):
        """ 找出股价前 10 的公司（蛮不错的嘛）"""

        data = self.pre_precess(2) # 股价位于第 3 列
        # 解决 plt 中文显示问题
        plt.rcParams['font.sans-serif'] = ['SimHei']
        plt.rcParams['axes.unicode_minus'] = False

        plt.figure()
        plt.title("最新股价前10位公司")
        plt.xlabel("企业")
        plt.ylabel("股价")

        x = []
        y = []
        for i in range(len(data)):
            x.append(data[i][1])
            y.append(data[i][2])
        x = x[-10:]
        y = y[-10:]

        #plt.plot(x, y) # 折线图
        plt.scatter(x, y, edgecolor='none', c='purple', s=100) # 散点图

        # plt.show() 后实际上已经创建了一个新的空白的图片（坐标轴）,
        # 这时候再 plt.savefig() 就会保存这个新生成的空白图片
        plt.savefig("股价.jpg", bbox_inches='tight')
        #plt.show()


    def ups_and_downs(self):
        """ 找出涨跌幅最高的 10 家公司（这也太惨了） """
        data = self.pre_precess(3) # 涨跌幅位于第 4 列
        plt.rcParams['font.sans-serif'] = ['SimHei']
        plt.rcParams['axes.unicode_minus'] = False

        plt.figure()
        plt.title("涨跌幅最高的 10 家公司")
        plt.xlabel("企业")
        plt.ylabel("涨跌幅")

        x = []
        y = []
        for i in range(len(data)):
            x.append(data[i][1])
            y.append(data[i][3])
        x = x[-10:]
        y = y[-10:]
        plt.scatter(x, y, edgecolor='none', c='purple', s=100)
        plt.savefig("涨跌幅.jpg", bbox_inches='tight')
        #plt.show()


    def volume(self):
        """ 找出成交量最高的 10 家公司（卖的还不错）"""
        data = self.pre_precess(6)  # 成交量位于第 7 列
        plt.rcParams['font.sans-serif'] = ['SimHei']
        plt.rcParams['axes.unicode_minus'] = False

        plt.figure()
        plt.title("成交量最高的 10 家公司")
        plt.xlabel("企业")
        plt.ylabel("成交量")

        x = []
        y = []
        for i in range(len(data)):
            x.append(data[i][1])
            y.append(data[i][6])
        x = x[-10:]
        y = y[-10:]
        plt.scatter(x, y, edgecolor='none', c='purple', s=100)
        plt.savefig("成交量.jpg", bbox_inches='tight')
        #plt.show()


    def busi_volume(self):
        """ 找出成交额最高的 10 家公司（这就很赚了） """
        data = self.pre_precess(7)  # 涨跌额位于第 8 列
        plt.rcParams['font.sans-serif'] = ['SimHei']
        plt.rcParams['axes.unicode_minus'] = False

        plt.figure()
        plt.title("成交额最高的 10 家公司")
        plt.xlabel("企业")
        plt.ylabel("成交额")

        x = []
        y = []
        for i in range(len(data)):
            x.append(data[i][1])
            y.append(data[i][7])
        x = x[-10:]
        y = y[-10:]
        plt.scatter(x, y, edgecolor='none', c='purple', s=100)
        plt.savefig("成交额.jpg", bbox_inches='tight')
        #plt.show()


    def cha_rate(self):
        """ 找出换手率最高的 10 家公司（看来经营的不咋地） """
        data = self.pre_precess(8)  # 换手率位于第 9 列
        plt.rcParams['font.sans-serif'] = ['SimHei']
        plt.rcParams['axes.unicode_minus'] = False

        plt.figure()
        plt.title("换手率最高的 10 家公司")
        plt.xlabel("企业")
        plt.ylabel("换手率")

        x = []
        y = []
        for i in range(len(data)):
            x.append(data[i][1])
            y.append(data[i][8])
        x = x[-10:]
        y = y[-10:]
        plt.scatter(x, y, edgecolor='none', c='purple', s=100)
        plt.savefig("换手率.jpg", bbox_inches='tight')
        #plt.show()


    def save_pic(self):
        """ 保存分析得到的图片 """
        pr = Process(target=self.price())
        up = Process(target=self.ups_and_downs())
        vo = Process(target=self.volume())
        bu = Process(target=self.busi_volume())
        ch = Process(target=self.cha_rate())

        pr.start()
        up.start()
        vo.start()
        bu.start()
        ch.start()



if __name__ == "__main__":
    os.chdir(r'C:\Users\Dell\Desktop')
    data = ['002947', '恒铭达', '37.93', '10.01%', '3.45', '0.00%', '27366.19', '9943.44', '9.01%', '12.85%', '1.10', '1.00', '--', '300414', '中光防雷', '20.77', '10.01%', '1.89', '0.00%', '44921.60', '8965.54', '2.85%', '10.75%', '1.00', '1.00', '109.69', '300600', '瑞特股份', '19.79', '10.01%', '1.80', '0.00%', '30086.76', '5694.92', '4.56%', '14.29%', '1.76', '1.00', '17.01', '000958', '东方能源', '7.26', '10.00%', '0.66', '0.00%', '1318398.28', '92261.45', '11.99%', '13.79%', '1.92', '1.00', '30.59', '002119', '康强电子', '11.66', '10.00%', '1.06', '0.00%', '51164.19', '5853.99', '1.81%', '12.17%', '2.07', '1.00', '44.21', '002674', '兴业科技', '15.40', '10.00%', '1.40', '0.00%', '50197.81', '7514.14', '2.09%', '15.64%', '1.03', '1.00', '103.02', '002750', '龙津药业', '15.29', '10.00%', '1.39', '0.00%', '289734.76', '43418.39', '7.29%', '12.16%', '2.10', '1.00', '109.78', '002927', '泰永长征', '28.82', '10.00%', '2.62', '0.00%', '22602.68', '6185.05', '4.40%', '12.82%', '1.07', '1.00', '--', '002946', '新乳业', '16.28', '10.00%', '1.48', '0.00%', '167214.25', '26208.48', '19.59%', '10.07%', '1.68', '1.00', '--', '300119', '瑞普生物', '21.78', '10.00%', '1.98', '0.00%', '113787.72', '24108.96', '5.91%', '8.99%', '0.78', '1.00', '69.92', '300333', '兆日科技', '9.46', '10.00%', '0.86', '0.00%', '307181.97', '28383.08', '9.28%', '13.95%', '2.55', '1.00', '100.55', '300573', '兴齐眼药', '60.84', '10.00%', '5.53', '0.00%', '31327.68', '17966.22', '5.86%', '15.02%', '0.54', '1.00', '142.72', '300770', '新媒股份', '77.11', '10.00%', '7.01', '0.00%', '96758.43', '71899.97', '30.14%', '12.92%', '1.14', '1.00', '--', '600300', '维维股份', '4.40', '10.00%', '0.40', '0.00%', '1330436.02', '57946.52', '7.96%', '4.75%', '2.86', '1.00', '20.10', '601606', '长城军工', '13.75', '10.00%', '1.25', '0.00%', '141741.49', '18454.84', '9.58%', '13.68%', '1.26', '1.00', '--', '603078', '江化微', '28.06', '10.00%', '2.55', '0.00%', '12854.60', '3528.02', '2.68%', '12.03%', '1.64', '1.00', '36.10', '603121', '华培动力', '23.53', '10.00%', '2.14', '0.00%', '58509.20', '13107.02', '13.00%', '15.94%', '1.88', '1.00', '--', '300290', '荣科科技', '10.02', '9.99%', '0.91', '0.00%', '68172.92', '6709.84', '2.12%', '9.22%', '0.96', '1.00', '224.06', '603777', '来伊份', '17.95', '9.99%', '1.63', '0.00%', '475825.44', '83022.74', '43.01%', '9.19%', '2.44', '1.00', '14.43', '000813', '德展健康', '10.14', '9.98%', '0.92', '0.00%', '412999.90', '40774.92', '3.82%', '9.87%', '2.01', '1.00', '34.89', '002758', '华通医药', '10.47', '9.98%', '0.95', '0.00%', '29988.75', '3078.38', '1.66%', '11.76%', '0.45', '1.00', '54.10', '600733', '北汽蓝谷', '9.81', '9.98%', '0.89', '0.00%', '238579.63', '22275.83', '6.01%', '13.57%', '0.89', '1.00', '1347.53', '002772', '众兴菌业', '8.38', '9.97%', '0.76', '0.00%', '118840.54', '9816.79', '4.65%', '12.60%', '2.15', '1.00', '15.57', '300427', '红相股份', '15.66', '9.97%', '1.42', '0.00%', '50725.70', '7560.34', '2.06%', '13.76%', '1.11', '1.00', '--', '300527', '中国应急', '12.68', '9.97%', '1.15', '0.00%', '431516.60', '52759.33', '16.72%', '13.18%', '2.04', '1.00', '362.70', '600734', '实达集团', '7.50', '9.97%', '0.68', '0.00%', '281896.65', '20653.96', '7.95%', '12.90%', '1.97', '1.00', '707.55', '002481', '双塔食品', '5.19', '9.96%', '0.47', '0.00%', '72211.18', '3747.76', '0.65%', '0.00%', '0.30', '1.00', '56.24', '002702', '海欣食品', '6.18', '9.96%', '0.56', '0.00%', '239154.38', '14581.66', '7.50%', '3.38%', '0.98', '1.00', '--', '300239', '东宝生物', '5.52', '9.96%', '0.50', '0.00%', '232553.09', '12836.93', '5.23%', '0.00%', '3.98', '1.00', '111.20', '300453', '三鑫医疗', '8.83', '9.96%', '0.80', '0.00%', '157977.29', '13453.83', '10.64%', '15.57%', '3.24', '1.00', '53.37', '002224', '三 力 士', '6.85', '9.95%', '0.62', '0.00%', '53162.93', '3641.66', '1.07%', '0.00%', '0.61', '1.00', '35.46', '002947', '恒铭达', '37.93', '10.01%', '3.45', '0.00%', '27366.19', '9943.44', '9.01%', '12.85%', '1.10', '1.00', '--', '300414', '中光防雷', '20.77', '10.01%', '1.89', '0.00%', '44921.60', '8965.54', '2.85%', '10.75%', '1.00', '1.00', '109.69', '300600', '瑞特股份', '19.79', '10.01%', '1.80', '0.00%', '30086.76', '5694.92', '4.56%', '14.29%', '1.76', '1.00', '17.01', '000958', '东方能源', '7.26', '10.00%', '0.66', '0.00%', '1318398.28', '92261.45', '11.99%', '13.79%', '1.92', '1.00', '30.59', '002119', '康强电子', '11.66', '10.00%', '1.06', '0.00%', '51164.19', '5853.99', '1.81%', '12.17%', '2.07', '1.00', '44.21', '002674', '兴业科技', '15.40', '10.00%', '1.40', '0.00%', '50197.81', '7514.14', '2.09%', '15.64%', '1.03', '1.00', '103.02', '002750', '龙津药业', '15.29', '10.00%', '1.39', '0.00%', '289734.76', '43418.39', '7.29%', '12.16%', '2.10', '1.00', '109.78', '002927', '泰永长征', '28.82', '10.00%', '2.62', '0.00%', '22602.68', '6185.05', '4.40%', '12.82%', '1.07', '1.00', '--', '002946', '新乳业', '16.28', '10.00%', '1.48', '0.00%', '167214.25', '26208.48', '19.59%', '10.07%', '1.68', '1.00', '--', '300119', '瑞普生物', '21.78', '10.00%', '1.98', '0.00%', '113787.72', '24108.96', '5.91%', '8.99%', '0.78', '1.00', '69.92', '300333', '兆日科技', '9.46', '10.00%', '0.86', '0.00%', '307181.97', '28383.08', '9.28%', '13.95%', '2.55', '1.00', '100.55', '300573', '兴齐眼药', '60.84', '10.00%', '5.53', '0.00%', '31327.68', '17966.22', '5.86%', '15.02%', '0.54', '1.00', '142.72', '300770', '新媒股份', '77.11', '10.00%', '7.01', '0.00%', '96758.43', '71899.97', '30.14%', '12.92%', '1.14', '1.00', '--', '600300', '维维股份', '4.40', '10.00%', '0.40', '0.00%', '1330436.02', '57946.52', '7.96%', '4.75%', '2.86', '1.00', '20.10', '601606', '长城军工', '13.75', '10.00%', '1.25', '0.00%', '141741.49', '18454.84', '9.58%', '13.68%', '1.26', '1.00', '--', '603078', '江化微', '28.06', '10.00%', '2.55', '0.00%', '12854.60', '3528.02', '2.68%', '12.03%', '1.64', '1.00', '36.10', '603121', '华培动力', '23.53', '10.00%', '2.14', '0.00%', '58509.20', '13107.02', '13.00%', '15.94%', '1.88', '1.00', '--', '300290', '荣科科技', '10.02', '9.99%', '0.91', '0.00%', '68172.92', '6709.84', '2.12%', '9.22%', '0.96', '1.00', '224.06', '603777', '来伊份', '17.95', '9.99%', '1.63', '0.00%', '475825.44', '83022.74', '43.01%', '9.19%', '2.44', '1.00', '14.43', '000813', '德展健康', '10.14', '9.98%', '0.92', '0.00%', '412999.90', '40774.92', '3.82%', '9.87%', '2.01', '1.00', '34.89', '002758', '华通医药', '10.47', '9.98%', '0.95', '0.00%', '29988.75', '3078.38', '1.66%', '11.76%', '0.45', '1.00', '54.10', '600733', '北汽蓝谷', '9.81', '9.98%', '0.89', '0.00%', '238579.63', '22275.83', '6.01%', '13.57%', '0.89', '1.00', '1347.53', '002772', '众兴菌业', '8.38', '9.97%', '0.76', '0.00%', '118840.54', '9816.79', '4.65%', '12.60%', '2.15', '1.00', '15.57', '300427', '红相股份', '15.66', '9.97%', '1.42', '0.00%', '50725.70', '7560.34', '2.06%', '13.76%', '1.11', '1.00', '--', '300527', '中国应急', '12.68', '9.97%', '1.15', '0.00%', '431516.60', '52759.33', '16.72%', '13.18%', '2.04', '1.00', '362.70', '600734', '实达集团', '7.50', '9.97%', '0.68', '0.00%', '281896.65', '20653.96', '7.95%', '12.90%', '1.97', '1.00', '707.55', '002481', '双塔食品', '5.19', '9.96%', '0.47', '0.00%', '72211.18', '3747.76', '0.65%', '0.00%', '0.30', '1.00', '56.24', '002702', '海欣食品', '6.18', '9.96%', '0.56', '0.00%', '239154.38', '14581.66', '7.50%', '3.38%', '0.98', '1.00', '--', '300239', '东宝生物', '5.52', '9.96%', '0.50', '0.00%', '232553.09', '12836.93', '5.23%', '0.00%', '3.98', '1.00', '111.20', '300453', '三鑫医疗', '8.83', '9.96%', '0.80', '0.00%', '157977.29', '13453.83', '10.64%', '15.57%', '3.24', '1.00', '53.37', '002224', '三 力 士', '6.85', '9.95%', '0.62', '0.00%', '53162.93', '3641.66', '1.07%', '0.00%', '0.61', '1.00', '35.46']
    data_analysis = Data_analysis(data)
    ''' 这里搞了很久,开始时同时保存图片总会出现错乱，原因是没有调用 plt.figure '''

    data_analysis.save_pic()

